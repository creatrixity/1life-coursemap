{"version":3,"file":"static/webpack/static\\development\\pages\\coursemap\\module\\lesson.js.52a2c1141febf310f6a8.hot-update.js","sources":["webpack:///./pages/coursemap/module/lesson/lesson.tsx"],"sourcesContent":["import * as React from 'react';\r\nimport { connect } from 'react-redux';\r\nimport convert from 'htmr';\r\n\r\nimport { bindActionCreators, Dispatch } from 'redux';\r\nimport Head from 'next/head';\r\nimport Link from 'next/link';\r\nimport { AppActions } from '@Actions';\r\n\r\nimport { Header, StarsCast, JournalInput } from '@Components';\r\nimport { ToolIcon, PlayIcon } from '@Components/Icons';\r\nimport Spinner from '@Components/LoadSpinner';\r\nimport { IHomePage, IStore } from '@Interfaces';\r\n\r\nimport ReactPlayer from 'react-player';\r\n\r\nimport '../../../coursemap/module.scss'\r\nimport {\r\n\tgetUser,\r\n\tgetToken\r\n} from '@Redux/utils';\r\nimport { computeModulesProgression } from '../../../../src/Helpers/index';\r\n\r\nexport class LessonPage extends React.Component<IHomePage.IProps, IHomePage.IState> {\r\n\tprivate course = '';\r\n\tprivate currentCourse:any = {};\r\n\tprivate currentCourseModule: {[id:string]: any} = {};\r\n\tprivate currentCourseModuleLessons:{[id:string]: any} = {};\r\n\tprivate lessonId:any = null;\r\n\tprivate module:any = null;\r\n\tprivate nextModule:any = null;\r\n\tprivate nextModuleData:any = null;\r\n\tprivate moduleTitle:any = null;\r\n\r\n\tconstructor (props:IHomePage.IProps) {\r\n\t\tsuper(props);\r\n\r\n\t\tthis.state = {\r\n\t\t\tmoduleProgression: 0,\r\n\t\t\tratingCumulative: 0\r\n\t\t}\r\n\r\n\t\tthis.handleSaveJournalInput = this.handleSaveJournalInput.bind(this);\r\n\t}\r\n\r\n\tcomponentDidMount () {\r\n\t\tif (!getToken()) return this.props.router.push('/login')\r\n\r\n\t\tconst { app, router } = this.props\r\n\r\n\t\tconst { course, lesson, module } = router.query;\r\n\t\tconst { coursemapModules, coursemapModulesContent } = app;\r\n\r\n\t\tconst lessonId = parseInt(lesson.split('-')[1]);\r\n\t\tconst currentCourse = coursemapModules[course];\r\n\t\tconst currentCourseModule:any = currentCourse.modules[module];\r\n\t\tconst currentCourseModuleLessons = currentCourseModule && currentCourseModule.lessons;\r\n\r\n\t\tthis.props.fetchCoursemapModule({\r\n\t\t\tmodule,\r\n\t\t\tcourse,\r\n\t\t\tid: lessonId\r\n\t\t}, coursemapModulesContent)\r\n\r\n\t\tthis.course = course;\r\n\t\tthis.currentCourse = currentCourse;\r\n\t\tthis.currentCourseModule = currentCourseModule;\r\n\t\tthis.currentCourseModuleLessons = currentCourseModuleLessons;\r\n\t\tthis.lessonId = lessonId;\r\n\t\tthis.module = module;\r\n\t\tthis.moduleTitle = currentCourseModule.title;\r\n\t\tthis.nextModule = currentCourseModule.nextModule;\r\n\t\tthis.nextModuleData = currentCourse.modules[this.nextModule];\r\n\t\t\r\n\t\tconst moduleId = currentCourseModule.id;\r\n\t\tconst moduleLessonsCount = Object.keys(currentCourseModuleLessons).length;\r\n\r\n\t\tconst user = getUser()\r\n\r\n\t\tthis.props.updateUserLesson({\r\n\t\t\tlessonId: lessonId,\r\n\t\t\tlessonsCount: moduleLessonsCount,\r\n\t\t\tmoduleId,\r\n\t\t\tcourseId: this.currentCourse.id,\r\n\t\t\tuserId: user.id,\r\n\t\t\tprogression: 100\r\n\t\t}, (lessons:any) => {\r\n\t\t\tconst moduleProgression = computeModulesProgression(lessons, moduleLessonsCount);\r\n\r\n\t\t\tthis.setState({\r\n\t\t\t\tmoduleProgression\r\n\t\t\t})\r\n\t\t});\r\n\r\n\t\tthis.props.getJournalFeedback({\r\n\t\t\tuser_id: user.id,\r\n\t\t\tcourse_id: currentCourse.id,\r\n\t\t\tmodule_id: currentCourseModule.id,\r\n\t\t\tlesson_id: lessonId,\r\n\t\t}, (feedback:any) => {\r\n\t\t\tlet feedbackData = feedback[currentCourse.id][currentCourseModule.id][lessonId]\r\n\r\n\t\t\tlet feedbackDataKeys = Object.keys(feedbackData).filter((key:any) => {\r\n\t\t\t\treturn feedbackData[key].type === 'rating'\r\n\t\t\t})\r\n\r\n\t\t\tconst ratingCumulative = feedbackDataKeys.reduce((previousValue:any, currentValue:any, currentIndex:any) => {\r\n\t\t\t\tconsole.log(parseInt(previousValue))\r\n\t\t\t\treturn parseInt(previousValue) + parseInt(feedbackData[feedbackDataKeys[currentIndex]]);\r\n\t\t\t}, 0)\r\n\t\t})\r\n\t}\r\n\r\n\tcomponentWillUnmount () {\r\n\t\tthis.handleSaveJournalInput = () => {};\r\n\t}\r\n\r\n\trenderModuleCardLink({\r\n\t\ticon,\r\n\t\ttitle\r\n\t}: {\r\n\t\ticon: any,\r\n\t\ttitle: string\r\n\t}):JSX.Element {\r\n\t\tconst Icon = icon;\r\n\r\n\t\treturn (\r\n\t\t\t<div className={'card d-flex flex-row module__link-card'}>\r\n\t\t\t\t<section className={'module__link-card__preview d-flex justify-content-center align-items-center'}>\r\n\t\t\t\t\t<Icon />\r\n\t\t\t\t</section>\r\n\t\t\t\t<section className={'px-3 py-4 module__link-card__content'}>\r\n\t\t\t\t\t<h5 className={'h6 module__link-card__title'}>{title}</h5>\r\n\t\t\t\t</section>\r\n\t\t\t</div>\r\n\t\t)\r\n\t}\r\n\r\n\tpublic renderUpcomingLinks(): JSX.Element {\t\t\r\n\t\tconst lessonsCount = Object.keys(this.currentCourseModuleLessons).length;\r\n\t\tconst nextLesson = this.currentCourseModuleLessons[this.lessonId + 1];\r\n\t\tconst hasValidNextLesson = nextLesson && Object.keys(nextLesson).length > 0;\r\n\t\tconst nextLessonTitle = hasValidNextLesson && nextLesson.title;\r\n\t\tconst nextLessonType = hasValidNextLesson && nextLesson.type;\r\n\t\tconst isAtLastLesson = this.lessonId === lessonsCount;\r\n\r\n\t\treturn (\r\n\t\t\t<section>\r\n\t\t\t\t{!isAtLastLesson && hasValidNextLesson ? (\r\n\t\t\t\t<div className={'mb-5'}>\r\n\t\t\t\t\t<h4 className={'h5'}>You've Completed Lesson {this.lessonId}</h4>\r\n\t\t\t\t\t<h5 className={'h6 mb-3 text-black-50'}>Let's move on to the next one.</h5>\r\n\r\n\t\t\t\t\t<Link prefetch href={`/courses/${this.course}/${this.module}/lesson-${this.lessonId + 1}`}>\r\n\t\t\t\t\t\t{this.renderModuleCardLink({\r\n\t\t\t\t\t\t\t\ticon: nextLessonType === 'lesson' ? PlayIcon: ToolIcon,\r\n\t\t\t\t\t\t\t\ttitle: nextLessonTitle\r\n\t\t\t\t\t\t})}\r\n\t\t\t\t\t</Link>\r\n\t\t\t\t</div>\r\n\t\t\t\t): (\r\n\t\t\t\t\t<div className={'mb-5'}>\r\n\t\t\t\t\t\t<h4 className={'h5 text-brand'}>Great! You've finished this module!</h4>\r\n\r\n\t\t\t\t\t\t{this.nextModuleData ?\r\n\t\t\t\t\t\t<>\r\n\t\t\t\t\t\t\t<h5 className={'h6 mb-3 text-black-50'}>You are doing awesome! Let's move on to the next one.</h5>\r\n\t\t\t\t\t\t\t<Link prefetch href={`/courses/${this.course}/${this.nextModule}`}>\r\n\t\t\t\t\t\t\t\t{this.renderModuleCardLink({\r\n\t\t\t\t\t\t\t\t\ticon: PlayIcon,\r\n\t\t\t\t\t\t\t\t\ttitle: this.nextModuleData && this.nextModuleData.title\r\n\t\t\t\t\t\t\t\t})}\r\n\t\t\t\t\t\t\t</Link>\r\n\t\t\t\t\t\t</>: \r\n\t\t\t\t\t\t<>\r\n\t\t\t\t\t\t<h5 className={'h6 mb-3 text-black-50'}>Whoohoo! You have finished this course!</h5>\r\n\t\t\t\t\t\t<Link prefetch href={`/courses`}>\r\n\t\t\t\t\t\t\t{this.renderModuleCardLink({\r\n\t\t\t\t\t\t\t\ticon: PlayIcon,\r\n\t\t\t\t\t\t\t\ttitle: 'See all courses'\r\n\t\t\t\t\t\t\t})}\r\n\t\t\t\t\t\t</Link>\r\n\t\t\t\t\t\t</>\r\n\t\t\t\t\t}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t)}\r\n\t\t\t</section>\r\n\t\t);\r\n\t}\r\n\r\n\thandleSaveJournalInput({ question, type, value, tag }: { value:string, question:string, tag: number, type: string }, callback:() => any) {\r\n\t\tthis.props.createJournalFeedback({\r\n\t\t\tquestion,\r\n\t\t\tanswer: value,\r\n\t\t\ttype,\r\n\t\t\tuser_id: getUser().id,\r\n\t\t\tcourse_id: this.currentCourse.id,\r\n\t\t\tmodule_id: this.currentCourseModule['id'],\r\n\t\t\tlesson_id: this.lessonId,\r\n\t\t\tfeedback_id: tag\r\n\t\t}, callback)\r\n\t}\r\n\r\n\tpublic render(): JSX.Element {\r\n\t\tconst { coursemapModulesContent, coursemapModulesFeedback } = this.props.app\r\n\t\tconst hasModulesFeedback = Object.keys(coursemapModulesFeedback).length;\r\n\r\n\t\tconst journalInputValue = hasModulesFeedback ? coursemapModulesFeedback[this.currentCourse.id][this.currentCourseModule.id][this.lessonId]: {};\r\n\r\n\t\tconst lessonData = coursemapModulesContent[this.course] && coursemapModulesContent[this.course][this.module][this.lessonId];\r\n\r\n\t\tlet lessonContent = lessonData ? lessonData.content: 'Loading...';\r\n\t\tconst content = convert(lessonContent, {\r\n\t\t\t\ttransform: {\r\n\t\t\t\t\treactplayer: (props:any) => <ReactPlayer url={props.url} width={'100%'} light playing />,\r\n\t\t\t\t\tratingfeedback: (props:any) => {\r\n\t\t\t\t\t\tconst { displaythreshold } = props;\r\n\t\t\t\t\t\tconst { ratingCumulative = 0 } = this.state;\r\n\r\n\t\t\t\t\t\tconst [rangeStart, rangeEnd] = displaythreshold.split(':')\r\n\r\n\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\tratingCumulative >= parseInt(rangeStart) &&\r\n\t\t\t\t\t\t\tratingCumulative <= parseInt(rangeEnd)\r\n\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\treturn props.children\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\treturn null;\r\n\t\t\t\t\t},\r\n\t\t\t\t\tjournalinput: (props:any) => {\r\n\t\t\t\t\t\tconst tag = parseInt(props.tag);\r\n\t\t\t\t\t\tconst value = journalInputValue && journalInputValue.hasOwnProperty(tag) ? journalInputValue[tag].answer: '';\r\n\r\n\t\t\t\t\t\treturn (\r\n\t\t\t\t\t\t\t<JournalInput\r\n\t\t\t\t\t\t\t\tonSaveJournalInput={this.handleSaveJournalInput}\r\n\t\t\t\t\t\t\t\ttag={tag}\r\n\t\t\t\t\t\t\t\ttype={props.type || 'textarea'}\r\n\t\t\t\t\t\t\t\tname={props.name}\r\n\t\t\t\t\t\t\t\tlabel={props.label}\r\n\t\t\t\t\t\t\t\tshowLabel={!props.showlabel}\r\n\t\t\t\t\t\t\t\tvalue={value}\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t)\r\n\r\n\t\treturn (\r\n\t\t\t<div className=\"d-flex flex-column module\" style={{ paddingTop: '100px' }}>\r\n\t\t\t\t<Head>\r\n\t\t\t\t\t<title>Lesson {this.lessonId} | Module: {this.moduleTitle}</title>\r\n\t\t\t\t</Head>\r\n\r\n        <Header\r\n\t\t\t\t\tbacklinkHref={`/courses/${this.course}/${this.module}`}\r\n\t\t\t\t\ttitle={`Lesson ${this.lessonId}`}\r\n\t\t\t\t\tstyle={{\r\n\t\t\t\t\t\tposition: 'fixed',\r\n\t\t\t\t\t\ttop: 0,\r\n\t\t\t\t\t\tzIndex: 900,\r\n\t\t\t\t\t\twidth: '100%'\r\n\t\t\t\t\t}}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t{!this.props.app.isUpdatingUserLesson ? <StarsCast progression={this.state.moduleProgression || 0} />: <Spinner width={'25px'} height={'25px'} />}\r\n\t\t\t\t</Header>\r\n\r\n\t\t\t\t<section>\r\n\t\t\t\t\t<div>\r\n\t\t\t\t\t\t<section className={'mb-5 container'}>\r\n\t\t\t\t\t\t\t{content}\r\n\t\t\t\t\t\t</section>\r\n\r\n\t\t\t\t\t\t<section className={'container'}>\r\n\t\t\t\t\t\t\t{this.renderUpcomingLinks()}\r\n\t\t\t\t\t\t</section>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</section>\r\n\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n}\r\n\r\nconst mapStateToProps = (state: IStore) => {\r\n\treturn {\r\n\t\tapp: state.app\r\n\t}\r\n};\r\n\r\nconst mapDispatchToProps = (dispatch: Dispatch) => (\r\n\t{\r\n\t\tupdateUserLesson: bindActionCreators(AppActions.updateUserLesson, dispatch),\r\n\t\tfetchCoursemapModule: bindActionCreators(AppActions.fetchCoursemapModule, dispatch),\r\n\t\tcreateJournalFeedback: bindActionCreators(AppActions.createJournalFeedback, dispatch),\r\n\t\tgetJournalFeedback: bindActionCreators(AppActions.getJournalFeedback, dispatch)\r\n\t}\r\n);\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(LessonPage);"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAGA;AAEA;AACA;AAIA;AAEA;AAAA;AAAA;AAAA;AACA;AAUA;AAAA;AACA;AADA;AACA;AAAA;AACA;AAFA;AACA;AADA;AACA;AADA;AACA;AADA;AACA;AADA;AACA;AADA;AACA;AADA;AACA;AADA;AACA;AADA;AACA;AAEA;AACA;AACA;AAFA;AAKA;AARA;AASA;AACA;AArBA;AAAA;AAAA;AAsBA;AACA;AAAA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAQA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAHA;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AANA;AAQA;AACA;AACA;AACA;AADA;AAGA;AAEA;AACA;AACA;AACA;AACA;AAJA;AAMA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAxFA;AAAA;AAAA;AA2FA;AACA;AA5FA;AAAA;AAAA;AAoGA;AAAA;AACA;AAEA;AACA;AAAA;AACA;AAAA;AAGA;AAAA;AACA;AAAA;AAIA;AAjHA;AAAA;AAAA;AAoHA;AACA;AACA;AACA;AACA;AACA;AAEA;AAGA;AAAA;AACA;AAAA;AACA;AAAA;AAEA;AAAA;AAAA;AAEA;AACA;AAFA;AAOA;AAAA;AACA;AAAA;AAIA;AAAA;AACA;AAAA;AAAA;AAEA;AACA;AAFA;AAOA;AAAA;AACA;AAAA;AAAA;AAEA;AACA;AAFA;AAWA;AArKA;AAAA;AAAA;AAuKA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AARA;AAUA;AAlLA;AAAA;AAAA;AAoLA;AACA;AADA;AAAA;AAAA;AAEA;AAEA;AAEA;AAEA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AAKA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAPA;AAUA;AAhCA;AADA;AAsCA;AACA;AAAA;AAAA;AAAA;AAAA;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AAJA;AAHA;AAUA;AAAA;AAAA;AAAA;AAAA;AAKA;AAAA;AAIA;AAAA;AAQA;AApQA;AACA;AADA;AAAA;AACA;AAsQA;AACA;AACA;AADA;AAGA;AACA;AACA;AAAA;AAEA;AACA;AACA;AACA;AAJA;AADA;AACA;AAQA;;;;;;;;;;;;;;;;;;;;;;;A","sourceRoot":""}